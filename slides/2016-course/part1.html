<!doctype html>
<html>
   <head>
      <meta charset="utf-8">

      <title>SIGGRAPH 2016 Course - Intro</title>

      <meta name="description" content="Frequency Analysis Course - Part I">
      <meta name="author" content="Laurent Belcour">

      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

      <link rel="stylesheet" href="../css/reveal.css">
      <link rel="stylesheet" href="../css/theme/beige.css" id="theme">
      <link rel="stylesheet" href="../css/androidstudio.css" id="theme">

      <script src="../js/head.min.js"></script>
      <script src="../js/snap.svg.js"></script>
      <script src="../js/reveal.js"></script>
      <script src="../../javascripts/fft.js"></script>
      <script src="../../javascripts/raytracer.js"></script>
      <script src="../../javascripts/course2016-part1.js"></script>
      <script src="../../javascripts/course2016-part2.js"></script>
   </head>
   <body>
   <script type="text/javascript">
      setData("general", "baseurl", "../../");
   </script>
      <div class="reveal">
         <!-- Any section element inside of this container is displayed as a slide -->
         <div class="slides">

            <!-- Title screen -->
            <section class="title"> <!-- data-background="./png/background.png" -->
            <h3>Part II: Frequency Operators</h3>
            </section>

            <section>
               <h4>Frequency Analysis of Light Transport</h4>
               <center style="margin-left:110px;">
               <div style="height:512px;">
               <div style="float:left;position:relative;width:512px;height:512px;margin:0;">
               <img id="local-analysis-01-img" src="../../data/images/dragon-01.png" width="512" height="512" style="border-width:0px;position:absolute;z-index:-1;margin:0px;top:0;left:0;" />
               <svg viewBox="0 0 512 512" style="width:512px;height:512px;position:absolute;z-index:1;top:0;left:0;" id="local-analysis-01"></svg>
               <canvas id="local-analysis-01-fft1" width="128" height="128" style="background-color:#FFF;border-width:0px;position:absolute;z-index:3;margin:0px;top:0;left:0;"></canvas>
               <canvas id="local-analysis-01-fft2" width="128" height="128" style="background-color:#FFF;border-width:0px;position:absolute;z-index:3;margin:0px;top:0;left:0;"></canvas>
               </div>
               <div style="float:right;position:relative;width:512;height:512px;margin:0;padding-right:120px">
                  <svg id="rendering-equation-02" width="512px" style="border-width: 0px;margin: 0;"></svg>
               </div>
               </div>
               </center>

               <script type="text/javascript">
                  function renderingEquation02Step00(snap) {
                     var layer = snap.select("#svg2")
                     layer.attr({width: 800, height: 512})
                     snap.select("#lens").attr({ opacity: 0 })
                  }
                  loadSVG("data/svg/course-pbr02.svg", "#rendering-equation-02", renderingEquation02Step00);

                  document.getElementById("local-analysis-01-img").onload = function() {
                    var inset1 = {size:32, x:150, y:200, color: "#aa0000", canvas: "local-analysis-01-fft1"};
                    var inset2 = {size:32, x:210, y:300, color: "#00aa00", canvas: "local-analysis-01-fft2"};
                    var windw1 = {size: 150, x:-150, y:-10};
                    var windw2 = {size: 150, x: 250, y:400};

                    localAnalysisCreateInset("#local-analysis-01", "local-analysis-01-img", inset1, windw1);
                    localAnalysisCreateInset("#local-analysis-01", "local-analysis-01-img", inset2, windw2);
                  }
               </script>
            </section>
            <section>
               <h4>Changing the Lense</h4>
               <center style="margin-left:110px;">
               <div style="height:512px;">
               <div style="float:left;position:relative;width:512px;height:512px;margin:0;">
               <img id="local-analysis-02-img" src="../../data/images/dragon-02.png" width="512" height="512" style="border-width:0px;position:absolute;z-index:-1;margin:0px;top:0;left:0;" />
               <svg viewBox="0 0 512 512" style="width:512px;height:512px;position:absolute;z-index:1;top:0;left:0;" id="local-analysis-02"></svg>
               <canvas id="local-analysis-02-fft1" width="128" height="128" style="background-color:#FFF;border-width:0px;position:absolute;z-index:3;margin:0px;top:0;left:0;"></canvas>
               <canvas id="local-analysis-02-fft2" width="128" height="128" style="background-color:#FFF;border-width:0px;position:absolute;z-index:3;margin:0px;top:0;left:0;"></canvas>
               </div>
               <div style="float:right;position:relative;width:512;height:512px;margin:0;padding-right:120px">
                  <svg id="rendering-equation-03" width="512px" style="border-width: 0px;margin: 0;"></svg>
               </div>
               </div>
               </center>

               <script type="text/javascript">
                  function renderingEquation03Step00(snap) {
                     var layer = snap.select("#svg2")
                     layer.attr({width: 800, height: 512})
                  }
                  loadSVG("data/svg/course-pbr02.svg", "#rendering-equation-03", renderingEquation03Step00);

                  document.getElementById("local-analysis-02-img").onload = function() {
                    var inset1 = {size:32, x:150, y:200, color: "#aa0000", canvas: "local-analysis-02-fft1"};
                    var inset2 = {size:32, x:210, y:300, color: "#00aa00", canvas: "local-analysis-02-fft2"};
                    var windw1 = {size: 150, x:-150, y:-10};
                    var windw2 = {size: 150, x: 250, y:400};

                    localAnalysisCreateInset("#local-analysis-02", "local-analysis-02-img", inset1, windw1);
                    localAnalysisCreateInset("#local-analysis-02", "local-analysis-02-img", inset2, windw2);
                  }
               </script>
            </section>
            <section>
               <h4>How to Predict Spectrum?</h4><br />
               <ul style="width:80%;">
                  <li>We want to predict the local Fourier Transform</li><br />
                  <li>Constraints:
                     <ul style="font-size:0.8em;">
                        <li>Analytical formulation</li>
                        <li>Extensible (can add defocus/motion blur)</li>
                        <li>Not restricted to screen-space</li>
                     </ul>
                  </li><br />
                  <li>Solution: Transport Operators</li>
               </ul>
            </section>
            <section>
               <h4>Break Paths using Operators</h4>
               <center style="width: 100%;position:absolute;top: 20px;left: 0;">
               <svg id="rendering-equation-04" width="1080" style="border-width: 0px;margin: 0;"></svg>
               </center>

               <script type="text/javascript">
                  loadSVG("data/svg/course-pbr02.svg", "#rendering-equation-04", renderingEquation04Step00);
               </script>
            </section>
            <section>
               <h4>Fourier Analysis using Operators</h4><br />
               <ul style="width:80%;">
                  <li>Operators decompose the Rendering Equation
                     <ul style="font-size:0.8em;">
                        <li>Travel in free space</li>
                        <li>Reflection and Transmission</li>
                        <li>Projection on surfaces</li>
                     </ul>
                  </li><br />
                  <li>We will use a <em>first-order expansion</em>
                     <ul style="font-size:0.8em;">
                        <li>Analytical forms</li>
                        <li>Simplify the input parameters (curvature for surfaces)</li>
                     </ul>
                  </li><br />
               </ul>

               <span style="position:absolute;top:500px;left:10%;width:40%;">
               <svg>
                  <defs>
                        <marker style="overflow:visible;" id="arrow" refX="0.0" refY="0.0" orient="auto">
                           <path transform="scale(0.3) rotate(180) translate(10,0)" style="fill-rule:evenodd;stroke:#000000;stroke-width:1pt;stroke-opacity:1;fill:#000000;fill-opacity:1" d="M 0.0,0.0 L 5.0,-5.0 L -12.5,0.0 L 5.0,5.0 L 0.0,0.0 z "/>
                        </marker>

                     </marker>
                  </defs>
                  <g transform="rotate(-20) translate(70, 130)">
                     <path d="m 0 0 150 0" stroke="black" stroke-width="3" style="marker-end:url(#arrow)" />
                     <circle cx="0" cy="0" r="5" stroke="black" stroke-width="3" fill="white" />

                  </g>
               </svg><br />
               $$L(\mathbf{x}, \boldsymbol{\omega})$$
               </span>
               <span style="position:absolute;top:500px;left:50%;width:40%;">
               <svg>
                  <defs>
                        <marker style="overflow:visible;" id="arrow" refX="0.0" refY="0.0" orient="auto">
                           <path transform="scale(0.3) rotate(180) translate(10,0)" style="fill-rule:evenodd;stroke:#000000;stroke-width:1pt;stroke-opacity:1;fill:#000000;fill-opacity:1" d="M 0.0,0.0 L 5.0,-5.0 L -12.5,0.0 L 5.0,5.0 L 0.0,0.0 z "/>
                        </marker>

                     </marker>
                  </defs>
                  <g transform="rotate(-20) translate(70, 100)">
                     <path transform="scale(4) rotate(0) translate(-8.5,-19)"  d="m 0,0 17.548095,5.94795 -0.448587,26.35563 -17.764371,6.75922 z" stroke="black" stroke-width="1" fill-opacity="0" />
                     <path d="m 0 0 150 0" stroke="black" stroke-width="3" style="marker-end:url(#arrow)" />
                     <circle cx="0" cy="0" r="5" stroke="black" stroke-width="3" fill="white" />

                     <g transform="scale(0.5)">
                        <g transform="translate(30, 50) rotate(10)">
                        <path d="m 0 0 150 0" stroke="black" stroke-width="3" style="marker-end:url(#arrow)" />
                        <circle cx="0" cy="0" r="5" stroke="black" stroke-width="3" fill="white" />
                        </g>
                        <g transform="translate(10, -50) rotate(-5)">
                        <path d="m 0 0 150 0" stroke="black" stroke-width="3" style="marker-end:url(#arrow)" />
                        <circle cx="0" cy="0" r="5" stroke="black" stroke-width="3" fill="white" />
                        </g>
                        <g transform="translate(-10, 50) rotate(20)">
                        <path d="m 0 0 150 0" stroke="black" stroke-width="3" style="marker-end:url(#arrow)" />
                        <circle cx="0" cy="0" r="5" stroke="black" stroke-width="3" fill="white" />
                        </g>
                        <g transform="translate(-25, -90) rotate(-10)">
                        <path d="m 0 0 150 0" stroke="black" stroke-width="3" style="marker-end:url(#arrow)" />
                        <circle cx="0" cy="0" r="5" stroke="black" stroke-width="3" fill="white" />
                        </g>
                        <g transform="translate(-20, 90) rotate(25.6)">
                        <path d="m 0 0 150 0" stroke="black" stroke-width="3" style="marker-end:url(#arrow)" />
                        <circle cx="0" cy="0" r="5" stroke="black" stroke-width="3" fill="white" />
                        </g>
                     </g>
                  </g>
               </svg><br />
               $$L(\mathbf{x} + \delta\mathbf{x}, \boldsymbol{\omega}+ \delta\boldsymbol{\omega})$$
               </span>
            </section>

            <section> <!-- We can do a clean formulation of the FT of L using
                           a two plane parametrization that maps directions
                           to a plane. -->
               <h4>Local Ray Space</h4>
               <center  style="transform:scale(1.5);padding-top:3em;">
               <object type="image/svg+xml" data="../../data/svg/cov_twoplanes.svg" width="604px" id="draw_cov_twoplanes"></object><br />
               <script src="../../javascripts/draw_cov_twoplanes.js" type="text/javascript">
               </script>
               </center>
            </section>
            <section> <!-- Here we show how the local FT in that space is made
                           suffiently small to be well defined. -->
               <h4>Local Ray Space</h4>
               <div style="text-align:left;padding:5%;">
               <ul>
                  <li>Redefine the Fourier Transform using a local window, $ W_l $:</li>
               </ul><br /><br />

               $$
                  \mathcal{F}_l[L](\Omega) = \int_{\delta\mathbf{z} \in \mathbb{R}^N} L(\mathbf{z} + \delta\mathbf{z}) W_l(\delta\mathbf{z}) e^{i 2 \pi \, \mathbf{\Omega}^T  \delta\mathbf{z}}, \; \mbox{where} \; \mathbf{z} = [\mathbf{x}, \mathbf{u}]
               $$<br />

               <ul>
                  <li>Interesting properties:
                     <ul style="font-size:0.8em;">
                        <li>Makes the Fourier Transform well defined (same surface).</li>
                        <li>We can use paraxial optics to express $ L(\delta\mathbf{x}) $. </li>
                        <li>The window increase the frequency content.</li>
                     </ul>
                  </li>
               </ul>
               </div>
            </section>
            <section> <!-- Because we use local analysis, we need to look at
                           the variations of elements in the Rendering Eq.
                           like curvature. -->
              <h4>Local Rendering Equation</h4><br /><br />
              <svg id="local-rendering-equation-01" width="956px" height="452px"></svg>
              <script>
              function localRenderingEq01Step00(snap) {
                // Scale the SVG
                var svg2 = snap.select("#layer1");
                svg2.transform(Snap.matrix().scale(4).add(svg2.transform().localMatrix));

                // Clear elements from display
                snap.select("#arrow01").attr({ class: "fragment", "data-fragment-index": 2 });
                snap.select("#cov01").attr({ class: "fragment", "data-fragment-index": 2 });
                snap.select("#cov02").attr({ class: "fragment", "data-fragment-index": 4 });
                snap.select("#cov03").attr({ class: "fragment", "data-fragment-index": 6 });
                snap.select("#cov04").attr({ class: "fragment", "data-fragment-index": 2 });
                snap.select("#op01").attr({ opacity: 0 });
                snap.select("#op02").attr({ opacity: 0 });
                snap.select("#op03").attr({ opacity: 0 });
                snap.select("#step01").attr({ class: "fragment", "data-fragment-index": 3 });
                snap.select("#step02").attr({ class: "fragment", "data-fragment-index": 5 });
                snap.select("#step03").attr({ class: "fragment", "data-fragment-index": 6});
                snap.select("#sensor01").attr({ class: "fragment", "data-fragment-index": 1 });
                snap.select("#sensor02").attr({ class: "fragment", "data-fragment-index": 3 });
                snap.select("#sensor03").attr({ class: "fragment", "data-fragment-index": 5 });
                snap.select("#sensor04").attr({ class: "fragment", "data-fragment-index": 1 });
              }

              function localRenderingEq01Step01(offset) {
              }
              loadSVG("data/svg/cov_path.svg", "#local-rendering-equation-01", localRenderingEq01Step00);
              </script>
            </section>
            <section> <!-- We need to break down the local rendering equation
                           into a set of different operators for which the
                           local FT will have closed forms. -->
               <h4>Rendering Operators</h4>
               <div style="width:60%">
                <ul>
                  <li>Input: Fourier transform</li>
                  <li>Output: Modified Fourier transform</li>
                </ul>
               </div><br />

               <div style="width:60%">
                <ul>
                  <li>Implementation example
                    <ul>
                      <li>Manipulation of the covariance matrix</li>
                      <li>Using Matlab's' syntax</li>
                    </ul>
                  </li>
                </ul>
               </div>
            </section>

            <!--
                                  The different operators
              -->

            <!-- Travel operator -->
            <section>
               <h4>Travel Operator</h4><br/>
               <center>
                  <div style="position:relative;width:900px;height:500px;">
                  <canvas id="draw_cov_travel-gl" style="position:absolute;"></canvas>
                  <svg id="draw_cov_travel-cv" width="900px" height="500px" style="position:absolute;top:0px;left:0px;"></svg>
                  </div>
               </center>
               <script type="text/javascript">
                  loadSVG("data/svg/cov_travel.svg", "#draw_cov_travel-cv", travelOperator01Step00);
               </script>
            </section>
            <section>
               <h4>Travel Operator</h4><br/>
               <div style="width:60%">
               <ul>
                 <li>Travel is a shear in local space</li>
               </ul>
               </div>

               <svg id="operator-travel-02" width="400px" height="250px"></svg>
               <script>
                 var snap  = Snap("#operator-travel-02");
                 var frame = CreateFrame(snap, 100, 50, 200, 200);
                 var cov   = CreateCovariance(snap, frame, Snap.matrix(0.9, 0, 0, 0.1, 0, 0));
                 cov.attr({id: "cov"})

                 var ShearAnimation = function(start, end) {
                  var s = Snap("#operator-travel-02");
                  var c = s.select("#cov");

                  const M = c.transform().localMatrix;
                  Snap.animate(start, end, function(val) {
                    c.transform(M);
                    var temp = Snap.matrix(1, val, 0, 1, 0, 0);
                    c.transform(c.transform().localMatrix.add(temp));
                  }, 500);
                }


                Reveal.addEventListener( 'fragmentshown', function( event ) {
                    if(event.fragment.id == "operator-travel-02-shear") {  ShearAnimation(0, 9); }
                });
                Reveal.addEventListener( 'fragmenthidden', function( event ) {
                    if(event.fragment.id == "operator-travel-02-shear") { ShearAnimation(0, -9); }
                });
               </script>
               <pre class="fragment" id="operator-travel-02-shear"></pre>

               <pre style="width:60%;" class="fragment">
               <code class="matlab">
% Travel of 'd' meters
Tr  = [1, d; 0, 1]
Cov = Tr' * Cov * Tr
               </code>
               </pre>
            </section>

            <!-- BRDF operator -->
            <section>
               <h4>BRDF Operator</h4><br/>
               <center>
                  <div style="position:relative;width:900px;height:500px;">
                  <canvas id="draw_cov_brdf-gl" style="position:absolute;"></canvas>
                  <svg id="draw_cov_brdf-cv" width="900px" height="500px" style="position:absolute;top:0px;left:0px;"></svg></div>
                  <div style="font-size:0.7em;">BRDF roughness: 0 <input style="vertical-align: middle;" type="range" min="0.0001" max="0.05" value="0.01" step="0.0005" id="draw_cov_brdf-slider" /> 0.05</div>
               </center>
               <script type="text/javascript">
                  loadSVG("data/svg/cov_brdf.svg", "#draw_cov_brdf-cv", brdfOperator01Step00);
               </script>
            </section>
            <section>
               <h4>BRDF Operator</h4><br/>
               <div style="width:60%">
               <ul>
                 <li>The BRDF cut the angular frequency
                    <ul class="sublist">
                      <li>Acts as a low-pass filter</li>
                      <li>Cutof depends on the BRDF lobe
                    </ul>
                  </li>
               </ul>
               </div>

               <svg id="operator-brdf-02" width="400px" height="250px"></svg>
               <script>
                 var snap  = Snap("#operator-brdf-02");
                 var frame = CreateFrame(snap, 100, 50, 200, 200);
                 var cov   = CreateCovariance(snap, frame, Snap.matrix(0.9, -0.9, 0, 0.1, 0, 0));
                 snap.rect(100, 100, 200, 100).attr({fill: "#aa0000", fillOpacity: 0.3});
               </script>

               <pre style="width:60%;" class="fragment">
               <code class="matlab">
% BRDF with cutof of 'b'
B   = [0, 0; 0, b]
Cov = inverse(inverse(Cov) + B)
               </code>
               </pre>
            </section>

            <!-- Occlusion operator -->
            <section>
               <h4>Visibility Operator</h4><br/>
               <center>
                  <div style="position:relative;width:900px;height:500px;">
                     <canvas id="draw_cov_occl-gl" style="position:absolute;background-color:#FFF;border:0px"></canvas>
                     <svg width="900px" height="500px" id="draw_cov_occl-cv" style="position:absolute;top:0px;left:0px;"></svg>
                     <!--<button id="draw_cov_occl_bt" type="button" style="position:absolute;left:400px;top:270px;margin-left:auto;margin-right:auto;">Fourier Transform!</button>-->
                  </div>
               </center>
               <script type="text/javascript">
                  loadSVG("data/svg/cov_occlusion.svg", "#draw_cov_occl-cv", occlOperator01Step00);
               </script>
            </section>
            <section>
               <h4>Visibility Operator</h4><br/>
               <div style="width:60%">
               <ul>
                 <li>Add frequencies in the spatial domain
                    <ul>
                       <li>Has infinite bandwidth!</li>
                    </ul>
                 </li>
               </ul>
               </div>

               <svg id="operator-occl-02" width="400px" height="250px"></svg>
               <script>
                 var snap  = Snap("#operator-occl-02");
                 var frame = CreateFrame(snap, 100, 50, 200, 200);
                 var cov   = CreateCovariance(snap, frame, Snap.matrix(0.9, -0.9, 0, 0.1, 0, 0));
                 //snap.rect(100, 100, 200, 100).attr({fill: "#aa0000", fillOpacity: 0.3});
               </script>

               <pre style="width:60%;" class="fragment">
               <code class="matlab">
% Visibility operation
Occ = [o, 0; 0, 0]
Cov = Cov + Occ
               </code>
               </pre>
            </section>


            <section>
               <h4>Summary: Frequency Operators</h4>
            </section>
            <section>
               <h4>Summary: A Unified Theory</h4>
            </section>

            <!-- Break before part2: applications -->
            <section class="title">
               <h4>Break: Questions?</h4><br />
               <a style="font-size:0.7em;float:right;padding-top:8em;" href="part2.html">> next part</a>
            </section>
         <div>
      </div>


      <script>
         // More info https://github.com/hakimel/reveal.js#configuration
         Reveal.initialize({
            controls: false,
            progress: true,
            history: true,
            center: false,
            slideNumber: true,
            transition: 'fade',
            width: 1280,
            height: 720,
            dependencies: [
              { src: '../js/mathjax.js', async: true },
              { src: '../js/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
            ]
         });

         // Reveal.addEventListener( 'fragmentshown', intro01anim01fw);
         // Reveal.addEventListener( 'fragmenthidden', intro01anim01bw);


         // Reveal.addEventListener( 'helloshown', function() { alert("Hello"); } );
         // Reveal.addEventListener( 'hellohidden', intro01anim01bw);
      </script>
   </body>
</html>