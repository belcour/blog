<!doctype html>
<html>
   <head>
      <meta charset="utf-8">

      <title>SIGGRAPH 2016 Course - Intro</title>

      <meta name="description" content="Frequency Analysis Course - Intro">
      <meta name="author" content="Laurent Belcour">

      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

      <link rel="stylesheet" href="../css/reveal.css">
      <link rel="stylesheet" href="../css/theme/beige.css" id="theme">
      <link rel="stylesheet" href="../css/androidstudio.css" id="theme">

      <script src="../js/head.min.js"></script>
      <script src="../js/snap.svg.js"></script>
      <script src="../js/reveal.js"></script>
      <script src="../../javascripts/fft.js"></script>
      <script src="../../javascripts/raytracer.js"></script>
      <script src="../../javascripts/course2016-part1.js"></script>
      <script src="../../javascripts/course2016-part2.js"></script>
   </head>
   <body>
      <!-- Update the relative url -->
      <script type="text/javascript">
         setData("general", "baseurl", "../../");
      </script>

      <div class="reveal">
         <!-- Any section element inside of this container is displayed as a slide -->
         <div class="slides">

            <!-- Title screen -->
            <section class="title"> <!-- data-background="./png/background.png" -->
            <h3>Part III - Applications</h3>
            <a style="font-size:0.7em;float:left;padding-top:25%" href="part1.html">< previous part</a>
            </section>

            <!-- The overview of the presentation -->
            <section>
               <h4>Overview</h4><br />
               <ol style="color:#aaaaaa;text-align:left;display:block;padding-left:3em;">
                  <li style="padding-bottom:0.5em;">Introduction</li>
                  <li style="padding-bottom:0.5em;">Frequency Operators
                     <ul style="font-size:0.6em;">
                        <li>Travel & Occlusion</li>
                        <li>Reflection & Refraction</li>
                        <li>Scattering & Absorption</li>
                     </ul>
                  </li>
                  <li style="color:#000000;padding-bottom:0.5em;">Applications
                     <ul style="font-size:0.6em;">
                        <li>Adaptive sampling & denoising</li>
                        <li>Upsampling</li>
                        <li>Density estimation</li>
                        <li>Antialiasing</li>
                     </ul>
                  </li>
                  <li style="padding-bottom:0.5em;">Conclusion</li>
               </ol>
            </section>

            <!-- The overview of the presentation -->
            <section>
               <h4>Overview</h4><br />
               <ol style="color:#aaaaaa;text-align:left;display:block;padding-left:3em;">
                  <li style="padding-bottom:0.5em;">Introduction</li>
                  <li style="padding-bottom:0.5em;">Frequency Operators
                     <ul style="font-size:0.6em;">
                        <li>Travel & Occlusion</li>
                        <li>Reflection & Refraction</li>
                        <li>Scattering & Absorption</li>
                     </ul>
                  </li>
                  <li style="color:#000000;padding-bottom:0.5em;">Applications
                     <ul style="font-size:0.6em;">
                        <li style="color:#5380E3;">Adaptive sampling & denoising</li>
                        <li style="color:#5380E3;">Upsampling</li>
                        <li style="color:#5E884C;">Density estimation</li>
                        <li style="color:#5E884C;">Antialiasing</li>
                     </ul>
                  </li>
                  <li style="padding-bottom:0.5em;">Conclusion</li>
               </ol>
            </section>

            <section>
               <h4>Working with Operators</h4>
               <center style="width: 100%;position:absolute;top: 50px;left: 0; transform: scale(0.9);">
               <svg id="working-operators-01" width="1080" style="border-width: 0px;margin: 0;"></svg>
               </center>

               <script type="text/javascript">
function workingOperator01Step00 (snap) {
   // Cleaning elements
   var layer = snap.select("#svg2");
   layer.attr({width: 1080});
   snap.select("#lens").attr({ opacity: 0 });
   snap.select("#path2-00").attr({ opacity: 0 });
   snap.select("#path2-01").attr({ opacity: 0 });

   var t1 = 0; // light
   var t2 = 335; // dragon
   var t3 = 1000; //sensor

   // Point at light
   var p = snap.select("#path1-00").getPointAtLength(t1);
   var c = snap.circle(p.x, p.y, 7).attr({ fill: "#ffffff", stroke: "#ff0000", strokeWidth: "4px", id: "cursor", filter: "drop-shadow( 2px 2px 2px #666 )"})
   snap.select("#lens").after(c);

   // Adding Fourier stuff
   var frame = CreateFrame(snap, 950, 150, 120, 120);
   var cov   = CreateCovariance(snap, frame, Snap.matrix(0.9, 0, 0, 0.1, 0, 0));
   //var gcov  = snap.g(frame, cov).attr({ id: "covariance-01"});

   frame = CreateFrame(snap, 950, 450, 120, 120);
   cov   = CreateCovariance(snap, frame, Snap.matrix(0.9, 0.9, 0, 0.1, 0, 0));
   //gcov  = snap.g(frame, cov).attr({ id: "covariance-02"});

   frame = CreateFrame(snap, 750, 600, 120, 120);
   cov   = CreateCovariance(snap, frame, Snap.matrix(0.6, -0.6, 0, 0.1, 0, 0));
   //gcov  = snap.g(frame, cov).attr({ id: "covariance-03"});

   frame = CreateFrame(snap, 230, 600, 120, 120);
   cov   = CreateCovariance(snap, frame, Snap.matrix(0.6, 0.1, 0, 0.1, 0, 0));
   //gcov  = snap.g(frame, cov).attr({ id: "covariance-04"});
}
loadSVG("data/svg/course-pbr02.svg", "#working-operators-01", workingOperator01Step00);
               </script>
            </section>
            <section>
               <h4><span style="color:#5380E3;">'Deferred'</span> Frequency Analysis</h4>
               <center style="padding-top:10px;"><div style="width:80%;text-align:left;"><ul>
                   <li class="fragment" data-fragment-index="1">Static analysis: using closed forms</li><br />
                  <li  class="fragment" data-fragment-index="2">Compatible with you favorite math toolbox
                     <ul class="fragment" data-fragment-index="3"><li>Last example with Mathematica</li></ul>
                  </li>
               </ul></div></center>
               <center class="fragment" data-fragment-index="4" style="padding-top:10px;"><div style="width:60%; background: #ffffff; text-align: left; padding: 25px 25px; box-shadow: 5px 5px 35px #dddddd;">
                     <div><img style="border:0px; box-shadow: 0 0 0; margin: 0px 0px; margin-bottom: 10px;" src="../../data/images/course-2d-covariance-01.gif" /></div>
                     <div class="fragment" data-fragment-index="5"><img style="border:0px; box-shadow: 0 0 0; margin: 0px 0px; margin-bottom: -30px;" src="../../data/images/course-2d-covariance-02.gif" /></div>
                     <div class="fragment" data-fragment-index="6"><img style="border:0px; box-shadow: 0 0 0; margin: 0px 0px;" src="../../data/images/course-2d-covariance-03.png" /></div>
                     <div class="fragment" data-fragment-index="6"><img style="border:0px; box-shadow: 0 0 0; margin: 0px 0px;" src="../../data/images/course-2d-covariance-04.png" /></div>
               </div></center>
            </section>
            <section>
               <h4><span style="color:#5380E3;">'Deferred'</span> Frequency Analysis</h4>
               <center style="padding-top:10px;"><div style="width:80%;text-align:left;"><ul>
                   <li class="fragment" data-fragment-index="1">Need a pre-pass to compute the spectrum
                       <ul>
                           <li>During G-buffer creation for interactive</li>
                           <li>During a sampling pre-pass for offline</li>
                       </ul>
                   </li><br />
               </ul></div></center>
               <object class="fragment" data-fragment-index="2" data="../../data/svg/course-gbuffer.svg" width="1280px"></object>
            </section>

            <section>
                <h4><span style="color:#5E884C;">'Online'</span> Frequency Analysis</h4>
               <center><div style="width:80%;text-align:left;"><ul>
                  <li class="fragment" data-fragment-index="1">When closed forms are not possible
                      <ul>
                          <li>Multiple scattering dominant</li>
                          <li>Multiple scenarios but same code (reflexion and refraction)</li>
                      </ul>
                  </li><br />
                  <li class="fragment" data-fragment-index="2">Inline frequency analysis in raytracing
                      <ul>
                          <li>See source code on <a href="https://github.com/belcour/CovarianceTracing">github</a></li>
                      </ul>
                  </li>
                </ul></div></center>
                <pre class="fragment" data-fragment-index="2" style="width:47%;float:left;margin:5px;padding:0px;">
                    <code>
Spectrum RayTrace(Ray r){

   // Check intersection
   hit = Intersect(scene, r);
   if(! hit) return Black;

   // Interaction with material
   Ray new_r = SampleBRDF(hit);
   return RayTrace(new_r);
}
                    </code>
                </pre><div  class="fragment" data-fragment-index="2" style="float:left;padding-top:100px;padding-left:15px;width:2%;">></div>
                <pre  class="fragment" data-fragment-index="2" style="width:47%;float:right;margin:5px;padding:0px;">
                    <code>
Spectrum RayTrace(Ray r, Covariance c){

   // Check intersection
   hit = Intersect(scene, r);
   if(! hit) return Black;

   // Evaluate covariance at the surface
   c.Travel(hit);
   c.Projection(hit);

   // Interaction with material
   Ray new_r = SampleBRDF(hit);

   // Compute reflected covariance
   c.Reflection(hit);
   c.InverseProjection(hit);

   return RayTrace(new_r, c);
}
                    </code>
                </pre>
            </section>


            <!-- Adaptive sampling and reconstruction -->
            <section class="title">
                <h4>Application to Adaptive Sampling & Reconstruction</h4>
            </section>
            <section>
               <h4>Adaptive Sampling and Reconstruction</h4><br />
               <center><div style="width:80%;text-align:left;"><ul>
                  <li>Direct application of Nyquist:
                    <ul>
                        <li>Adapt the sampling rate w/r $ B_W $</li>
                        <li>Reconstruct using a kernel (usualy Gaussian)</li>
                    </ul>
                  </li><br />
                  <li class="fragment" data-fragment-index="1">Share samples across pixels</li><br />
                  <li class="fragment" data-fragment-index="1">Avoid over-sampling when not needed</li>
               </ul></div></center><br />
            </section>
            <section><!-- Integration sapce and reconstruction space -->
                <h4>Adaptive Sampling and Reconstruction</h4>
                <center style="padding-top:20px;"><div style="width:80%;text-align:left;"><ul>
                  <li>However a specific context:
                      <ul>
                          <li>Reconstruct in pixel space</li>
                          <li>Integrate in lens/light/time space</li>
                      </ul>
                  </li>
               </ul></div></center>
               <center style="padding-top:10px;transform:scale(1.0);">
                   <svg id="adaptive-sampling-01-svg" width="800px" height="235px"></svg>
               </center>
               <script type="text/javascript" >
                   var uri  = "data/svg/course-integration02.svg";
                   var elem = "#adaptive-sampling-01-svg";

                   function adaptiveSampling01(snap) {
                     snap.select("#samples").attr({class: 'fragment', 'data-fragment-index': 1});
                     snap.select("#samples02").attr({class: 'fragment', 'data-fragment-index': 2});
                     snap.select("#splat01").attr({ opacity: 0 });

                     snap.text(700, 40, "Requires many samples").attr({ fontSize: "0.6em", class: 'fragment', 'data-fragment-index': 1 });
                     snap.text(700, 420, "Requires few samples").attr({ fontSize: "0.6em", class: 'fragment', 'data-fragment-index': 2 });
                   }

                   loadSVG(uri, elem, adaptiveSampling01);
               </script>
            </section>
            <section><!-- Integration sapce and reconstruction space -->
                <h4>Adaptive Sampling and Reconstruction</h4>
                <center style="padding-top:20px;"><div style="width:80%;text-align:left;"><ul>
                  <li>Algorithm:
                      <ol type="I">
                          <li>Compute bandwidth per pixel</li>
                          <li>Sample XYUVT space</li>
                          <li>Integrate in UVT space & reconstruct in XY space</li>
                      </ol>
                  </li>
               </ul></div></center><br />
               <center style="padding-top:10px;transform:scale(1.3);">
                   <svg id="adaptive-sampling-02-svg" width="1066px" height="235px"></svg>
               </center>
               <script type="text/javascript" >
                   var uri  = "data/svg/course-applications01.svg";
                   var elem = "#adaptive-sampling-02-svg";
                   loadSVG(uri, elem, null);
               </script>
            </section>
            <section><!-- Integration sapce and reconstruction space -->
                <span style="position:absolute;font-size:0.7em;text-align:right;width:100%;left:0px;top:-20px;"><img src="../../data/images/acm.png"  height="32px" style="border:0px;box-shadow:none;margin:0px;vertical-align:-5px;">&nbsp;<a href="#url(durand2005)">Soler et al. 2009</a></span>
                <h4>Adaptive Sampling and Reconstruction</h4>
                <center style="padding-top:20px;"><div style="width:80%;text-align:left;"><ul>
                  <li>Example of lens integration
                      <ul>
                          <li>Operators: Reflection + Travel + Occlusion + Lens</li>
                          <li>Adapt the sampling of the lens and in screen space</li>
                      </ul>
                  </li>
               </ul></div></center><br />
               <center style="padding-top:70px;transform:scale(1.4);">
                   <svg id="example01-svg" width="800px" height="235px"></svg>
               </center>
               <script type="text/javascript" >
                   var uri  = "/data/svg/course-integration01.svg";
                   var elem = "#example01-svg";
                   loadSVG(uri, elem, createExample01);
                Reveal.addEventListener( 'fragmentshown', function( event ) {
                    if(event.fragment.id == "adaptiveSampling01Step01") { adaptiveSampling01Step01(1); }
                    if(event.fragment.id == "adaptiveSampling01Step02") { adaptiveSampling01Step02(1); }
                    if(event.fragment.id == "adaptiveSampling01Step03") { adaptiveSampling01Step03(1); }
                    if(event.fragment.id == "adaptiveSampling01Step04") { adaptiveSampling01Step02(0); }
                    if(event.fragment.id == "adaptiveSampling01Step05") { adaptiveSampling01Step05(1); }
                });
                Reveal.addEventListener( 'fragmenthidden', function( event ) {
                    if(event.fragment.id == "adaptiveSampling01Step01") { adaptiveSampling01Step01(0); }
                    if(event.fragment.id == "adaptiveSampling01Step02") { adaptiveSampling01Step02(0); }
                    if(event.fragment.id == "adaptiveSampling01Step03") { adaptiveSampling01Step03(0); }
                    if(event.fragment.id == "adaptiveSampling01Step04") { adaptiveSampling01Step02(1); }
                    if(event.fragment.id == "adaptiveSampling01Step05") { adaptiveSampling01Step05(0); }
                });
               </script>
               <pre class="fragment" id="adaptiveSampling01Step01"></pre>
               <pre class="fragment" id="adaptiveSampling01Step02"></pre>
               <pre class="fragment" id="adaptiveSampling01Step03"></pre>
               <pre class="fragment" id="adaptiveSampling01Step04"></pre>
               <pre class="fragment" id="adaptiveSampling01Step05"></pre>


            </section>
            <section>
            <h4>Results</h4><br />
               <svg id="adaptive-sampling-03" width="1325" height="462" style="position:absolute;top:150px;left:-30px;"></svg>
               <script type="text/javascript" >
var uri  = "/data/svg/course-adaptive-results.svg";
var elem = "#adaptive-sampling-03";

function adaptiveSampling03Step00(snap) {
    // Create a slider from the adaptive sampling images
    function adaptiveSampling03Inset(x, y, event) {
        var snap = Snap("#adaptive-sampling-03");
        var g = snap.select("#clipRect");
        var s = snap.select("#separator");
        var b = snap.select("#block");
        s.attr({transform: "t" + x + ",0"});
        g.attr({transform: "t" + x + ",0"});
    }
    snap.drag(adaptiveSampling03Inset);
}

loadSVG(uri, elem, adaptiveSampling03Step00);
               </script>
            </section>
             <section><!-- Integration sapce and reconstruction space -->
                <h4>Alternative Methods</h4>
                <center style="padding-top:20px;"><div style="width:80%;text-align:left;"><ul>
                  <li>Gradient adaptive sampling
                      <ul>
                          <li>[<a href="ramamoorthi2007">Ramamoorthi et al. 2007</a>]</li>
                      </ul>
                  </li><br />
                  <li>Heuristic adaptive sampling
                      <ul>
                          <li>[<a href="hachisuka2009">Hachisuka et al. 2009</a>]</li>
                      </ul>
                  </li>
               </ul></div></center><br />
               <center><div style="font-size:0.5em;width:50%;">
                  <div style="float:left;">
                     <img src="../../data/images/course-adaptive-gradient.png" height="256px" /><br />
                     [<a href="ramamoorthi2007">Ramamoorthi et al. 2007</a>]
                  </div>
                  <div style="float:right;">
                     <img style="border:0px;box-shadow:0px 0px;" src="../../data/svg/course-adaptive-hachisuka.svg" height="258px" /><br />
                     [<a href="hachisuka2009">Hachisuka et al. 2009</a>]
                  </div>
               </div></center>
            </section>



            <!-- Upsampling -->
            <section class="title">
                <h4>Application to Upsampling</h4>
            </section>
            <section>
                <span style="position:absolute;font-size:0.7em;text-align:right;width:100%;left:0px;top:-20px;"><img src="../../data/images/acm.png"  height="32px" style="border:0px;box-shadow:none;margin:0px;vertical-align:-5px;">&nbsp;<a href="#url(bagher2013)">Bagher et al. 2013</a></span>
               <h4>Upsampling</h4>
               <center><div style="width:80%;text-align:left;"><ul>
                  <li>Dual of reconstruction
                      <ul>
                          <li>Instead of gather samples for a pixel, splat them</li>
                          <li>Equivalent to shade <strong>bigger</strong> pixels</li>
                      </ul>
                  </li>
               </ul></div></center>
               <center style="padding-top:10px;transform:scale(1.0);">
                   <svg id="splatting-sampling-01-svg" width="800px" height="235px"></svg>
               </center>
               <script type="text/javascript" >
                   var uri  = "data/svg/course-integration02.svg";
                   var elem = "#splatting-sampling-01-svg";

                   function adaptiveSampling01(snap) {
                     snap.select("#samples").attr({opacity: 0});
                     snap.select("#samples02").attr({opacity: 0});
                     snap.select("#splat01").attr({ class: "fragment" });
                     snap.select("#subsamples").attr({ class: "fragment" });
                   }

                   loadSVG(uri, elem, adaptiveSampling01);
               </script>
            </section>
            <section>
                <span style="position:absolute;font-size:0.7em;text-align:right;width:100%;left:0px;top:-20px;"><img src="../../data/images/acm.png"  height="32px" style="border:0px;box-shadow:none;margin:0px;vertical-align:-5px;">&nbsp;<a href="#url(bagher2013)">Bagher et al. 2013</a></span>
               <h4>Upsampling</h4>
                <div style="position:relative;width:100%">
                    <object width="100%" data="../../data/svg/course-applications02.svg" type="image/svg+xml"></object>
                </div>
            </section>
            <section>
                <video  height="700px" controls id="upsampling-video">
                    <source src="upsampling.mp4#t=59" type="video/mp4" ></source>
                    <source src="https://hal.inria.fr/hal-00652066v4/file/Final_Video-11-Apr-2012_QT_5Mbps.mov#t=59" type="video/mov"></video>
                </video>
            </section>
            <section>
                <video  height="700px" controls id="upsampling-video">
                    <source src="upsampling.mp4#t=34" type="video/mp4" ></source>
                    <source src="https://hal.inria.fr/hal-00652066v4/file/Final_Video-11-Apr-2012_QT_5Mbps.mov#t=34" type="video/mov"></video>
                </video>
            </section>
             <section><!-- Integration sapce and reconstruction space -->
                <h4>Alternative Methods</h4>
                <center><div style="width:80%;text-align:left;"><ul>
                  <li>Shading <strong>bigger</strong> pixels
                      <ul>
                          <li>Global-Illumination upsampling [<a href="nichols2009">Nichols et al. 2009</a>]</li>
                          <li>Coarse Pixel Shading [<a href="vaidyanathan2014">Vaidyanathan et al. 2014</a>]</li>
                      </ul>
                  </li><br />
                  <li>Splatting more samples
                      <ul>
                          <li>Off-line resampling [<a href="lehtinen2011">Lehtinen et al. 2011</a>, <a href="lehtinen2012">Lehtinen et al. 2012</a>]</li>
                      </ul>
                  </li>
               </ul></div></center><br />
               <center><div style="font-size:0.5em;width:50%;">
                  <div style="float:left;">
                     <img src="../../data/images/course-lehtinen2011.png" height="256px" /><br />
                     [<a href="lehtinen2011">Lehtinen et al. 2011</a>]
                  </div>
                  <div style="float:left;">
                     <img src="../../data/images/course-vaidyanathan2014.png" height="256px" /><br />
                     [<a href="vaidyanathan2014">Vaidyanathan et al. 2014</a>]
                  </div>
               </div></center>
            </section>

            <!-- Tracing from the light ! -->
            <section class="title">
                <h4>Application to Photon Mapping</h4>
            </section>

            <!-- Adaptive density estimation -->
            <section data-transition="slide-in slide-out">
               <span style="position:absolute;font-size:0.7em;text-align:right;width:100%;left:0px;top:-40px;"><img src="../../data/images/acm.png"  height="32px" style="border:0px;box-shadow:none;margin:0px;vertical-align:-7px;">&nbsp;<a href="#url(belcour2011)">Belcour and Soler 2011</a></span>
               <h4>Adaptive Density Estimation</h4>
               <center style="width:100%">
                   <svg id="photon-mapping-02" width="1280" height="720"></svg>
               </center>
               <script type="text/javascript" >
                var uri  = "data/svg/course-photon-mapping-02.svg";
                var elem = "#photon-mapping-02"

                function photonMapping02Step00(snap) {
                    snap.select("#variance").attr({ opacity: 0 });
                    snap.select("#bias").attr({ opacity: 0 });
                    snap.select("#adaptive").attr({ opacity: 0 });

                    snap.select("#eye01a").attr({ opacity: 0 });
                    snap.select("#hit01").attr({ opacity: 0 });
                    snap.select("#eye02").attr({ opacity: 0 });
                    snap.select("#eye03").attr({ opacity: 0 });

                    snap.select("#photona").attr({ opacity: 0 });
                    snap.select("#photonb").attr({ opacity: 0 });
                }

                function photonMapping02Step00a(opacity) {
                    var snap = Snap(elem);
                    snap.select("#eye01a").attr({ opacity: opacity });
                    snap.select("#hit01").attr({ opacity: opacity });
                    snap.select("#eye02").attr({ opacity: opacity });
                    snap.select("#eye03").attr({ opacity: opacity });
                }

                function photonMapping02Step00b(opacity) {
                    var snap = Snap(elem);
                    snap.select("#photona").animate({ opacity: opacity}, 500);
                    snap.select("#photonb").animate({ opacity: opacity}, 1000);
                }

                function photonMapping02Step01(opacity) {
                    var snap = Snap(elem);
                    snap.select("#bias").attr({ opacity: opacity });
                }

                function photonMapping02Step02(val, opacity) {
                    var snap = Snap(elem);
                    var gp1 = snap.select("#gather01");
                    var gp2 = snap.select("#gather02");
                    var gp3 = snap.select("#gather03");
                    gp1.animate({ rx : val*gp1.attr('rx'), ry : val*gp1.attr('ry')}, 500);
                    gp2.animate({ rx : val*gp2.attr('rx'), ry : val*gp2.attr('ry')}, 500);
                    gp3.animate({ rx : val*gp3.attr('rx'), ry : val*gp3.attr('ry')}, 500);
                    snap.select("#bias").animate({ opacity: opacity }, 500);
                }

                function photonMapping02Step03(opacity) {
                    var snap = Snap(elem);
                    snap.select("#variance").attr({ opacity: opacity });
                }

                function photonMapping02Step04(val2, opacity) {
                    var snap = Snap(elem);
                    var gp2 = snap.select("#gather02");
                    var gp3 = snap.select("#gather03");
                    gp2.animate({ rx : val2*gp2.attr('rx'), ry : val2*gp2.attr('ry')}, 500);
                    gp3.animate({ rx : val2*gp3.attr('rx'), ry : val2*gp3.attr('ry')}, 500);
                    snap.select("#variance").animate({ opacity: opacity }, 500);
                    snap.select("#adaptive").animate({ opacity: 1.0-opacity }, 500);
                }

                loadSVG(uri, elem, photonMapping02Step00);

                var gpScale = 0.25;
                Reveal.addEventListener( 'fragmentshown', function( event ) {
                    if(event.fragment.id == "photonMapping02Step00a") { photonMapping02Step00a(1); }
                    if(event.fragment.id == "photonMapping02Step00b") { photonMapping02Step00b(1); }
                    if(event.fragment.id == "photonMapping02Step01") { photonMapping02Step01(1); }
                    if(event.fragment.id == "photonMapping02Step02") { photonMapping02Step02(gpScale, 0); }
                    if(event.fragment.id == "photonMapping02Step03") { photonMapping02Step03(1); }
                    if(event.fragment.id == "photonMapping02Step04") { photonMapping02Step04(1.0/gpScale, 0); }
                });
                Reveal.addEventListener( 'fragmenthidden', function( event ) {
                    if(event.fragment.id == "photonMapping02Step00a") { photonMapping02Step00a(0); }
                    if(event.fragment.id == "photonMapping02Step00b") { photonMapping02Step00b(0); }
                    if(event.fragment.id == "photonMapping02Step01") { photonMapping02Step01(0); }
                    if(event.fragment.id == "photonMapping02Step02") { photonMapping02Step02(1.0/gpScale, 1); }
                    if(event.fragment.id == "photonMapping02Step03") { photonMapping02Step03(0); }
                    if(event.fragment.id == "photonMapping02Step04") { photonMapping02Step04(gpScale, 1); }
                });
               </script>
               <pre class="fragment" id="photonMapping02Step00a"></pre>
               <pre class="fragment" id="photonMapping02Step00b"></pre>
               <pre class="fragment" id="photonMapping02Step01"></pre>
               <pre class="fragment" id="photonMapping02Step02"></pre>
               <pre class="fragment" id="photonMapping02Step03"></pre>
               <pre class="fragment" id="photonMapping02Step04"></pre>
            </section>
            <section>
                <h4>Density Estimation</h4>
               <center><div style="width:80%;text-align:left;padding-top:15px;"><ul>
                <li>Initial radius has a big impact
                    <ul>
                        <li>[<a href="kaplanyan2013">Kaplanyan et al. 2013</a>]</li>
                    </ul>
               </li><br />
               <li>At the core of some modern techniques:
                   <ul>
                        <li>PPM [<a href="hachisuka2009">Hachisuka et al. 2009</a>]</li>
                        <li>VCM [<a href="georgiev2013">Georgiev et al. 2013<a/>][<a href="hachisuka2013">Hachisuka et al. 2013</a>]</li>
                   </ul>
               </li>
               </ul></div></center>
            </section>
            <section data-transition="slide-in fade-out">
               <h4>Adaptive Density Estimation</h4><br />
               <center><div style="width:80%;text-align:left;padding-top:15px;"><ul>
                  <li>Mathematical insight:
                      <ul>
                          <li>Density estimation <em>blurs</em> the target result</li>
                          <li>Theoretically: $ \mbox{bias} \propto \mbox{Laplacian} \times \mbox{radius}^2 $</li>
                      </ul>
                  </li>
               </ul></div></center>
               <center style="width:100%;padding-left:40px;">
                 <object width="1200px" data="../../data/svg/course-photon-mapping-01.svg" type="image/svg+xml"></object>
               </center>
            </section>
            <section>
               <h4>Adaptive Density Estimation</h4>
               <center><div style="width:80%;text-align:left;padding-top:15px;"><ul>
                  <li>How to Estimate Laplacian?
                      <ul>
                          <li>Covariance in Fourier = Hessian!</li>
                          <li>Covariance from photons is averaged for each kernel</li>
                      </ul>
                  </li><br />
                  <li class="fragment">Works as well in volumes
                      <ul>
                          <li>Adapt kernels for the Photon Beams method [<a href="jarosz2011">Jarosz et al. 2011</a>]</li>
                          <li>Covariance must be stored in a 3D grid</li>
                      </ul>
                  </li>
               </ul></div></center>
            </section>
            <section>
                <h4>Results</h4><br />
                <object type="image/svg+xml" data="../../data/svg/course-photon-mapping-03.svg" style="border:none;box-shadow:none;" width="90%"></object><br />
            </section>
            <section>
                <h4>Results</h4>
                <img src="../../data/images/course-fppb-01.png" style="border:none;box-shadow:none;" width="70%"/><br />
                <div style="font-size:0.6em;"><span style="padding-right:20%;">[<a href="belcour2014">Belcour et al. 2014</a>]</span><span>[<a href="jarosz2011">Jarosz et al. 2011</a>]</span></div>
                <div style="font-size:0.6em;"><span style="padding-right:15%;">9.7M beams, 25min render</span><span>10M beams, 25min render</span></div>
            </section>
            <section><!-- Talk about Anton's paper APPM -->
                <h4>Alternative Methods</h4><br />
                <center><div style="width:80%;text-align:left;"><ul>
                <li>Progressive Hessian estimation
                    <ul>
                        <li>[<a href="hachisuka20">Hachisuka 2010</a>] [<a href="kaplanyan2013">Kaplanyan et al. 2013</a>]</li>
                    </ul>
                </li><br />
            </ul></div></center><br />
            <center><div style="font-size:0.5em;width:50%;">
                <div style="float:left;padding-left:50px;">
                    <img src="../../data/svg/course-hachisuka2010.svg" height="256px" style="max-width:100%;" /><br />
                    [<a href="hachisuka2010">Hachisuka et al. 2010</a>]
                </div>
                <div style="float:left;padding-left:50px;">
                    <img src="../../data/svg/course-kaplanyan2013.svg" height="256px" style="max-width:100%;" /><br />
                    [<a href="kaplanyan2013">Kaplanyan et al. 2013</a>]
                </div>
            </div></center>
            </section>


            <!-- Antialiasing -->
            <section class="title">
                <h4>Application to Antialiasing</h4>
            </section>
            <section>
               <span style="position:absolute;font-size:0.7em;text-align:right;width:100%;left:0px;top:-40px;"><img src="../../data/images/thesis.png"  height="32px" style="border:0px;box-shadow:none;margin:0px;vertical-align:-7px;">&nbsp;<a href="#url(belcour2015)">Belcour et al. 2015</a></span>
               <h4>Antialiasing Surface Appearance</h4><br />
               <center><div style="width:80%;text-align:left;"><ul>
                  <li>Idea: bound the reflectance frequencies
                      <ul>
                          <li>Adapt variation to screen resolution</li>
                      </ul>
                  </li>
               </ul></div></center><br />

               <table style="font-size:0.7em;">
                    <tr>
                        <th><img src="../../data/images/course-antialiasing-gt.jpg" /></th>
                        <th><img src="../../data/images/course-antialiasing-near.jpg" /></th>
                    </tr>
                    <tr>
                        <th>Ground truth</th>
                        <th>Nearest evaluation</th>
                    </tr>
               </table><br />
                <div style="float:right;font-size:0.5em;">Image from Mitsuba [Wenzel Jakob]</div>
            </section>
            <section>
               <h4>Antialiasing Surface Appearance</h4>
               <svg id="antialiasing01" width="800px" height="500px" style="margin-top:70px;"></svg>
               <script>
                  loadSVG("slides/2016-covariance-filtering/svg/singlescatter.svg", "#antialiasing01", antialiasingAppearance01Step00);
               </script>
            </section>
            <section>
               <h4>Antialiasing Surface Appearance</h4>
               <svg id="antialiasing02" width="800px" height="500px" style="margin-top:70px;"></svg>
               <script>
                  loadSVG("slides/2016-covariance-filtering/svg/filtering01.svg", "#antialiasing02", antialiasingAppearance02Step00);
               </script>
            </section>
            <section>
               <h4>Limitation of Decoupling & Pixel Footprint</h4><br />
               <center><div style="width:80%;text-align:left;"><ul>
                  <li class="fragment">Break with bidirectional path-tracing (BDPT, VCM)
                      <ul>
                          <li>Light variations must be accounted</li>
                      </ul>
                  </li><br />
                  <li class="fragment">Assume the view and light directions are constant
                  </li><br/>
                  <li class="fragment">Using a 'binary'' footprint
                      <ul><li>Doesn't account for the pixel filter</li>
                      <li>Limited to single scattering</li></ul>
                  </li>
               </ul></div></center>
            </section>
            <section>
               <h4>Antialiasing Surface Appearance</h4><br />
               <center><div style="width:80%;text-align:left;"><ul>
                  <li>Pixel filter is a kernel applied on the surface!</li>
               </ul></div></center><br />
               <svg class="fragment" id="antialiasing03" width="800px" height="500px" style="margin-top:-70px;transform:scale(1.2);"></svg>
               <script>
                  loadSVG("slides/2016-covariance-filtering/svg/filtering02.svg", "#antialiasing03", antialiasingAppearance03Step00);
               </script>
            </section>
            <section>
               <h4>Frequency Analysis Perspective</h4><br />
               <center><div style="width:80%;text-align:left;"><ul>
                  <li>This kernel is a low-pass filter on the SV-BRDF:</li>
               </ul></div></center><br />
               <svg id="antialiasing04" width="800px" height="450px" style="margin-top:-50px;"></svg>
               <script type="text/javascript">
                  var s = Snap("#antialiasing04");
                  createFilter(s, 0, 400, 790, 300, 400);
               </script>
            </section>
            <section>
               <h4>Antialiasing and Global Illumination</h4>
               <center><div style="width:80%;text-align:left;"><ul>
                  <li>The kernel can account for multiple bounces:</li>
               </ul></div></center><br />
               <svg id="antialiasing05" width="800px" height="480px" style="margin-top:-40px;"></svg>
               <script>
                  loadSVG("slides/2016-covariance-filtering/svg/multiscatter.svg", "#antialiasing05", null);
               </script>
              <center><div style="width:80%;text-align:left;margin-top:40px;"><ul>
                  <li>How can we estimate the kernel in that case?</li>
               </ul></div></center><br />
            </section>
            <section>
               <h4>Covariance Antialiasing</h4><br />
               <svg id="cov03" width="800px" height="600px"></svg>
               <script type="text/javascript">
                  loadElementFromSVG("slides/2016-covariance-filtering/svg/bidir-filter-example.svg", "#cov03", "#layer3", antialiasingAppearance06Step00);

                  // Animation for the slide {forward and backward}
                  Reveal.addEventListener( 'fragmentshown', function( event ) {
                     if(event.fragment.id == "cov03shear01") { Cov03ShearCov(1); Cov03MoveCursor01(1); return; }
                     if(event.fragment.id == "cov03kernel01") { Cov03DisplayKernel(1); return; }
                  });
                  Reveal.addEventListener( 'fragmenthidden', function( event ) {
                     if(event.fragment.id == "cov03shear01") { Cov03ShearCov(-1); Cov03MoveCursor01(-1); return; }
                     if(event.fragment.id == "cov03kernel01") { Cov03DisplayKernel(-1); return; }
                  });
               </script>
               <p class="fragment" id="cov03shear01"></p>
               <p class="fragment" id="cov03kernel01"></p>
            </section>


            <!-- Demo of our uni-directionnal kernels -->
            <section>
            <h4>Comparison to Ground Truth Kernel</h4><br />
            <svg id="demo01" width="512" height="512"></svg><br />
            <script>
               var s = Snap("#demo01");
               var x = 225;
               s.clear();
               s.image("../2016-covariance-filtering/png/unidirectional-filter-cov.png", 0, 0, 512, 512);
               var block = s.rect(0, x, 512, 512).attr({fill: "#ffffff", id: "block"});
               var image = s.image("../2016-covariance-filtering/png/unidirectional-filter-ref.png", 0, 0, 512, 512);
               var line  = s.line(0, x, 512, x).attr({id: "line", stroke: "#000", strokeWidth:2});
               s.rect(1, 1, 510, 510).attr({fillOpacity: 0, strokeWidth: 2, stroke: "#000"});
               var textu = s.text(500, x-15, "predicted kernel").attr({fillOpacity: 0.7, fill: "#FD5154", fontSize: "0.6em", textAnchor: "end"});
               var textl = s.text(500, x+25, "ground truth kernel").attr({fillOpacity: 0.7, fill: "#59FE5B", fontSize: "0.6em", textAnchor: "end"});
               var g = s.g(block, line, textu, textl).attr({id: "group"});
               image.attr({id: "image", mask: block});

               s.circle(320, 365, 5).attr({fill: "#aaaaff", stroke: "#5555ff", strokeWidth: 2});
               s.text(330, 370, "pixel").attr({fontSize: "0.6em", fillOpacity: 0.9, fill: "#aaaaff"})

               const demo01move = function(x, y, event) {
                  var s = Snap("#demo01");
                  var g = s.select("#group");
                  var i = s.select("#image");
                  var b = s.select("#block");
                  g.transform("t0," + y);
                  b.attr({transform: "t0," + y});
                  i.attr({mask: s.select("block")});
               }

               s.drag(demo01move);
            </script>
            <small>Kernel after one bounce</small>
            </section>
            <!-- Bidirectionnal path tracing -->
            <section>
            <h4>Bidirectional Antialiasing</h4><br />
            <svg id="bidir01" width="1000px" height="600px" style="transform:scale(1.2);"></svg>
            <script type="text/javascript">
               Snap.load("../2016-covariance-filtering/svg/bidir-filter-example.svg", function (f) {
                  var s = Snap("#bidir01");
                  var layer= f.select("#layer1");
                  var defs = f.select("#defs4");

                  s.append(layer.transform(Snap.matrix(1, 0, 0, 1, -130, -40)));
                  s.append(defs);
                  var arrow = s.polygon([0,5, 4,5, 2,0, 0,5]).attr({fill: '#000'}).transform('r90');
                  var marker = arrow.marker(0,0, 5,5, 0,2.5).attr({id: "marker"});

                  s.select("#lightFootprint").attr({ opacity: 0 });

                  var g0 = createGaussian(s, 800, 60, 100, 300, 100, "vertical", {stroke: "#00ff00"});
                  var g1 = createGaussian(s, 800, 60, 100, 300, 500, "vertical", {id: "lightGaussian", opacity: 0, stroke: "#0000ff"});
                  var g2 = createGaussian(s, 220, 450, 300, 100, 300, "horizontal", {stroke: "#00ff00"});
                  s.text(770, 380, "wrong eye kernel!").transform("r90").attr({id: "text", opacity:0, fontSize: "0.7em", fill: "#ff0000", textAnchor: "middle"});
               });

               function BidirStep01(offset){
                   var snap = Snap("#bidir01");
                   if(offset > 0) {
                     snap.select("#text").attr({ opacity: 1 });
                     snap.select("#lightGaussian").attr({ opacity: 1 });
                     snap.select("#lightFootprint").attr({ opacity: 1 });
                   } else {
                     snap.select("#text").attr({ opacity: 0 });
                     snap.select("#lightGaussian").attr({ opacity: 0 });
                     snap.select("#lightFootprint").attr({ opacity: 0 });
                   }
               }
                  // Animation for the slide {forward and backward}
                  Reveal.addEventListener( 'fragmentshown', function( event ) {
                     if(event.fragment.id == "bidir-step01") { BidirStep01(1); return; }
                  });
                  Reveal.addEventListener( 'fragmenthidden', function( event ) {
                     if(event.fragment.id == "bidir-step01") { BidirStep01(-1); return; }
                  });
            </script>

               <p class="fragment" id="bidir-step01"></p>
               <p class="fragment" id="bidir-step01"></p>
            </section>

            <section>
            <h4>Bidirectional Antialiasing</h4>
            <svg id="bidir02" width="900px" height="600px" style="transform:scale(1.2);"></svg>
            <script type="text/javascript">
               Snap.load("../2016-covariance-filtering/svg/filtering03.svg", function (f) {
                  var s = Snap("#bidir02");
                  var layer= f.select("#layer2");
                  var defs = f.select("#defs4");
                  s.select("defs").remove();
                  s.append(defs);
                  s.append(layer.transform(Snap.matrix(1, 0, 0, 1, 0, 70)));
                  s.text(325, 360, "eye kernel").attr({fontSize: "0.6em", textAnchor: "middle"});
                  s.text(660, 360, "light kernel").attr({fontSize: "0.6em", textAnchor: "middle"});
                  s.text(490, 360, "material").attr({fontSize: "0.6em", textAnchor: "middle"});
                  s.text(830, 360, "light").attr({fontSize: "0.6em", textAnchor: "middle"});
               });
            </script>
            </section>

            <section>
            <h4>Bidirectional Antialiasing</h4>
            <div class="fragment" style="position:absolute;padding-left:500px;padding-top:340px;">$$ \Sigma_e \; + \; \Sigma_l \; = \; \Sigma $$</div>
            <svg id="bidir03" width="900px" height="600px" style="transform:scale(1.2);"></svg>
            <script type="text/javascript">
               Snap.load("../2016-covariance-filtering/svg/filtering03.svg", function (f) {
                  var s = Snap("#bidir03");
                  var layer= f.select("#layer3");
                  var defs = f.select("#defs");
                  s.append(layer.transform(Snap.matrix(1, 0, 0, 1, 0, -300)));
                  s.select("defs").remove();
                  s.append(defs);

                  s.text(275, 280, "eye kernel").attr({fontSize: "0.6em", textAnchor: "middle"});
                  s.text(650, 280, "bidir kernel").attr({fontSize: "0.6em", textAnchor: "middle"});
                  s.text(450, 280, "light kernel").attr({fontSize: "0.6em", textAnchor: "middle"});
               });
            </script>
            </section>
            <!-- Results -->
            <section>
               <!--<iframe volume="0" data-autoplay width="100%" height="600px" src="https://www.youtube.com/embed/_Sh8xcspWG8?start=127&end=166&rel=0" frameborder="0" allowfullscreen></iframe>-->
               <video controls id="covariance-filtering-video">
                   <source width="100%" height="600px" src="covariance-filtering.m4v" ></source>
                </video>
            </section>
            <section><!-- Other antialiasing kernel things? -->
                <h4>Alternative Methods</h4>
                <center><div style="width:80%;text-align:left;"><ul>
                    <li>Predict filtering footprint
                      <ul>
                          <li>Ray differentials [<a href="igehy1999">Igehy 1999</a>]</li>
                          <li>Path differentials [<a href="suykens2001">Suykens and Willems 2001</a>]</li>
                      </ul>
                  </li><br />
                  <li>Antialiasing distant lighting
                      <ul>
                          <li>Filtered Importance Sampling [<a href="krivanek2009">Krivanek and Colbert 2009</a>]</li>
                          <li>Rough transmission [<a href="derousiers2012">De Rousiers et al. 2012</a>]</li>
                      </ul>
                  </li>
               </ul></div></center>
               <center><div style="font-size:0.5em;width:50%;">
                  <div style="float:left;">
                     <img src="../../data/svg/course-filtering-igehy1999.svg" height="256px" style="max-width:100%;max-height:100%;"/><br />
                     [<a href="igehy1999">Igehy 1999</a>]
                  </div>
                  <div style="float:right;">
                     <img src="../../data/svg/course-filtering-suykens2001.svg" height="256px" style="max-width:100%;max-height:100%;"/><br />
                     [<a href="igehy1999">Suykens and Willems 2001</a>]
                  </div>
               </div></center>
            </section>

            <!-- Antialiasing -->
            <section class="title">
                <h4>Practical Considerations</h4>
            </section>
            <section>
                <h4>Light Sources</h4><br />
                <center><div style="width:80%;text-align:left;"><ul>
                    <li class="fragment">Need Fourier spectrum for each light type
                      <ul>
                          <li>Analytical forms for point, spot and area</li>
                          <li>For envmaps, we need to numerically compute its FFT</li>
                      </ul>
                  </li><br />
                  </ul></div></center>
                  <object class="fragment" data="../../data/svg/course-lights.svg" type="image/svg+xml"></object>
            </section>
            <section>
                <h4>Textures</h4><br />
                <center><div style="width:80%;text-align:left;"><ul>
                    <li class="fragment">Albedo texture
                      <ul>
                          <li>FFT Required for 'online' analysis</li>
                          <li>For single scattering it is better to decouple from shading</li>
                      </ul>
                  </li><br />
                    <li class="fragment">Roughness texture
                      <ul>
                          <li>Correlates spatial and angular frequencies</li>
                          <li>In practice we only consider spatial</li>
                      </ul>
                  </li><br />
                    <li class="fragment">Mip-level for different windows</li><br />
                  </ul></div></center>
            </section>
            <section>
                <h4>BRDFs/BSDFs</h4><br />
                <center><div style="width:80%;text-align:left;"><ul>
                    <li class="fragment">Need analytical forms in practice
                        <ul>
                            <li>Not always the case (microfacets)</li>
                            <li>Use conversion to Phong (approximate is good enough)</li>
                            <li>Get the Hessian is an alternative [<a href="belcour2014">Belcour et al. 2014</a>]</li>
                        </ul>
                    </li><br />
                    <li class="fragment">Measured data (e.g. MERL)
                        <ul>
                            <li>Store a 2D texture of FFT slices [<a href="bagher2011">Bagher et al. 2012</a>]</li>
                        </ul>
                    </li>
                </ul></div></center>
            </section>


            <!-- Break before part2: applications -->
            <section class="title">
               <h4>Break: Questions?</h4><br />
               <a style="font-size:0.7em;float:right;padding-top:22%" href="part3.html">> next part</a>
            </section>
         <div>
      </div>


      <script>
         // More info https://github.com/hakimel/reveal.js#configuration
         Reveal.initialize({
            controls: false,
            progress: true,
            history: true,
            center: false,
            slideNumber: true,
            transition: 'fade',
            width: 1280,
            height: 720,
            showNotes: true,
            dependencies: [
              { src: '../js/mathjax.js', async: true },
              { src: '../js/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
            ]
         });
      </script>
   </body>
</html>